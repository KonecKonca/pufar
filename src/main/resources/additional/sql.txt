1) поиск юзеров с которыми последний раз общались

SELECT user_id, login, password, status, ban_status isBanned, MAX(dialog_number) max_number
	FROM(
		SELECT u.user_id, u.login, u.password, u.status, u.ban_status, MAX(d.dialog_id) dialog_number FROM users u
		INNER JOIN dialoges d ON u.user_id = d.user_receiver_id
			WHERE u.user_id IN(
				SELECT u.user_id FROM users u
					WHERE u.user_id IN(

					SELECT d1.user_receiver_id FROM users u1
						INNER JOIN dialoges d1 ON u1.user_id = d1.user_sender_id
						WHERE d1.user_sender_id=1

						UNION

					SELECT d2.user_sender_id FROM users u2
						INNER JOIN dialoges d2 ON u2.user_id = d2.user_receiver_id
						WHERE d2.user_receiver_id=1

					)
				)
				AND d.user_sender_id=1
			GROUP BY u.user_id

		UNION

		SELECT u.user_id, u.login, u.password, u.status, u.ban_status, MAX(d.dialog_id) FROM users u
			INNER JOIN dialoges d ON u.user_id = d.user_sender_id
				WHERE u.user_id IN(
					SELECT u.user_id FROM users u
						WHERE u.user_id IN(

						SELECT d1.user_receiver_id FROM users u1
							INNER JOIN dialoges d1 ON u1.user_id = d1.user_sender_id
							WHERE d1.user_sender_id=1

							UNION

						SELECT d2.user_sender_id FROM users u2
							INNER JOIN dialoges d2 ON u2.user_id = d2.user_receiver_id
							WHERE d2.user_receiver_id=1

						)
					)
					AND d.user_receiver_id=1
				GROUP BY u.user_id
	) t
	GROUP BY user_id
	ORDER BY max_number DESC
	LIMIT 15;


1) то же самое, только старый хреновый вариант
    private static final String SEARCH_POPULAR_USER_SQL =
            "(SELECT u.user_id, u.login, u.password, u.status, u.ban_status isBanned FROM users u " +
                "INNER JOIN dialoges d1 ON u.user_id = d1.user_receiver_id WHERE d1.user_sender_id = ? GROUP BY u.login ORDER BY d1.date) " +
                    "UNION " +
            "(SELECT u2.user_id, u2.login, u2.password, u2.status, u2.ban_status isBanned FROM users u2 " +
                "INNER JOIN dialoges d2 ON u2.user_id = d2.user_sender_id WHERE d2.user_receiver_id = ? GROUP BY u2.login ORDER BY d2.date) LIMIT ?";